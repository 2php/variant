# Unofficial and incomplete build file using Boost build system.
# You should use make unless you know what you are doing.

import os ;

local boost_dir = [ os.environ BOOST_DIR ] ;
if ! $(boost_dir)
{
    boost_dir = "/usr/local" ;
}

#using clang : : ;

local cxx_std = [ os.environ CXX_STD ] ;
if ! $(cxx_std)
{
    cxx_std = c++11 ;
}

project mapbox_variant
    : requirements
      <cxxflags>-std=$(cxx_std)
      <include>$(boost_dir)/include
      <include>include
      <include>test/include
      <variant>release:<cxxflags>-march=native
      <threading>single:<define>SINGLE_THREADED
    : default-build
      <variant>release
      <optimization>speed
      <threading>single
    ;

exe variant-test
    : test/bench_variant.cpp
    : <variant>release:<cxxflags>-Wweak-vtables
    ;
explicit variant-test ;

exe binary-visitor-test
    : test/binary_visitor_test.cpp
    ;
explicit binary-visitor-test ;    

exe recursive-wrapper-test
    : test/recursive_wrapper_test.cpp
    ;
explicit recursive-wrapper-test ;

exe unique-ptr-test
    : test/unique_ptr_test.cpp
    ;
explicit unique-ptr-test ;

exe reference_wrapper_test
    : test/reference_wrapper_test.cpp
    ;
explicit reference_wrapper_test ;    

exe lambda_overload_test
    : test/lambda_overload_test.cpp
    ;
explicit lambda_overload_test ;

exe hashable_test
    : test/hashable_test.cpp
    ;
explicit hashable_test ;

install out
    : variant-test
      binary-visitor-test
      unique-ptr-test
      reference_wrapper_test
      lambda_overload_test
      hashable_test
    ;   
